name: Auto News Bot 🤖🗞️

on:
  schedule:
    # Randomized human-like schedule (IST times with variable UTC windows)
    # Each run happens in a 15–20 minute natural window
    - cron: "15-45 3 * * *"   # 9:00 AM ±15m IST
    - cron: "35-55 6 * * *"   # 12:15 PM ±10m IST
    - cron: "20-40 10 * * *"  # 4:00 PM ±10m IST
    - cron: "20-40 12 * * *"  # 6:00 PM ±10m IST
    - cron: "50-59 13 * * *"  # 7:30 PM ±10m IST
    - cron: "50-59 14 * * *"  # 8:30 PM ±10m IST
    - cron: "0-20 16 * * *"   # 9:40 PM ±10m IST
    - cron: "10-30 17 * * *"  # 10:50 PM ±10m IST
    - cron: "15-35 18 * * *"  # 11:55 PM ±10m IST
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 45

    steps:
      - name: 🧾 Checkout repository
        uses: actions/checkout@v4

      - name: 🐍 Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: 📦 Install dependencies
        run: |
          pip install --upgrade pip
          pip install requests tweepy

      - name: 🧠 Run Auto News Bot
        env:
          PERPLEXITY_API: ${{ secrets.PERPLEXITY_API }}
          API_KEY: ${{ secrets.API_KEY }}
          API_SECRET: ${{ secrets.API_SECRET }}
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          ACCESS_SECRET: ${{ secrets.ACCESS_SECRET }}
        run: |
          echo ""
          echo "------------------------------------------------------------"
          echo "🕒 Current UTC: $(date -u)"
          echo "🕒 Current IST: $(TZ='Asia/Kolkata' date)"
          echo "------------------------------------------------------------"
          echo ""

          # --- HUMAN-LIKE BEHAVIOUR SECTION ---
          # Randomly skip 1–2 scheduled runs per day (simulate human behavior)
          skip=$((RANDOM % 9))  # ~11% skip chance per run
          if [ $skip -eq 0 ]; then
            echo "😴 Feeling lazy today... skipping this run to look natural."
            exit 0
          fi

          # Random delay within ±20 min window for each run
          delay=$(( (RANDOM % 2400) - 1200 ))  # -20 min to +20 min
          if [ $delay -gt 0 ]; then
            echo "☕ Waiting for $delay seconds (~$((delay/60)) min) before posting..."
            sleep $delay
          else
            echo "⚡ Running slightly earlier today (offset: ${delay}s)..."
          fi
          # --- END HUMAN-LIKE SECTION ---

          echo ""
          echo "🚀 Launching Auto News Bot..."
          python -u bot6.py
          echo "✅ News Bot finished successfully at $(TZ='Asia/Kolkata' date)"
          echo "------------------------------------------------------------"
